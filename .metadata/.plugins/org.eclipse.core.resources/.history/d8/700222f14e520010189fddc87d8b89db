<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
	<!--<title>कलेक्शन</title> -->
	<title>स्वश्रयी महिला सख सहकारी संस्था मर्यादित, इंदौर</title>
	<style th:replace="includes/style :: style"></style>
	<link href="style/viewAgentStyle.css" rel="stylesheet" />
	<script src="https://printjs-4de6.kxcdn.com/print.min.js"></script>
</head>

<body class="backgroundColor">
	<header th:replace="includes/header :: header"></header>
	<div class="container">
		<div class="row text-center">
			<div class="col-sm-12 col-md-12">
				<a href="/myapp/home" class="btn btn-info text-white float-end">पीछे जाइये</a>
			</div>
		</div>
		<div class="row">
			<div class="col-sm-12 col-md-12 mt-4" th:if="${MultipleCollectionList != null}">
				<h3 class="heading text-center">मल्टीपल डेनोमिनेशन सूची</h3>
			

			
			<div class="text-center">
				<div class="table-responsive" id="table">
					<table class="table table-editable">
						<thead class="thead">
							<tr class="table-success">
								<!--<th></th>-->
								<th>ग्राहक क्रमांक</th>
								<th>कलेक्शन तारीख</th>
								<th>ग्राहक नाम</th>
								<th>रसीद क्रमांक</th>
								<th>पेमेंट</th>
								<th>कलेक्शन राशि</th>
								<!--<th></th>-->
							</tr>
						</thead>
					<!--	<tbody>-->
							<tr th:each="collection : ${MultipleCollectionList}">
								<!--<form th:action="@{/makeCollection0}" method="post"
										th:object="${collectionInfoList}">-->
								<!--<td>
											<input class="form-check-input" type="checkbox" id="checkbox"
												name="checkbox" th:value="${collection.customerId}">
										</td>-->
								<td th:text="${collection.customerId}"></td>
								<td th:utext="${collection.collectionDate}"></td>
								<td th:utext="${collection.localLanguageName}"></td>
								<td th:text="${collection.receiptNo}"></td>
								<td th:text="${collection.paymentMethod}"></td>
								<td th:text="${collection.collectionAmount}" id="collectionAMT"></td>
								<input type="hidden" name="customerId" th:value="${collection.customerId}" />
								<input type="hidden" name="collectionDate" th:value="${collection.collectionDate}" />
								<input type="hidden" name="localLanguageName"
									th:value="${collection.localLanguageName}" />
								<input type="hidden" name="receiptNo" th:value="${collection.receiptNo}" />
								<input type="hidden" name="collectionAmount"
									th:value="${collection.collectionAmount}" />
								<!--<td><input type="submit" class="btn btn-success" value="Cancel" /></td>-->
								<!--</form>-->
							</tr>
							<!--<tr class="table-dark">-->
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<!--<td></td>-->
							<!--<td>TOTAL</td>
									<td id="totalCollectionAmount"></td>
									<td></td>-->
							<tr class="table-dark" id="totalRow">
								<td colspan="4"></td>
								<td><strong>TOTAL</strong></td>
								<td id="totalCollectionAmount"></td>
							</tr>
							</tr>
								<!-- Denomination Modal -->
						<div id="denominationModal" class="modal" style="display: none;">
							<div class="modal-content">
								<h2 class="modal-title">Denomination Entry</h2>
								<form id="denominationForm">
									<input type="hidden" id="denominationCustomerId" name="customerId" />
									<input type="hidden" id="asondate" name="asondate"
										th:value="${#dates.format(#dates.createNow(), 'dd-MMM-yy')}" />
									<div class="denomination-grid">
										<label>₹2000: <input type="number" id="r2000" value="0" min="0"></label>
										<label>₹500: <input type="number" id="r500" value="0" min="0"></label>
										<label>₹200: <input type="number" id="r200" value="0" min="0"></label>
										<label>₹100: <input type="number" id="r100" value="0" min="0"></label>
										<label>₹50: <input type="number" id="r50" value="0" min="0"></label>
										<label>₹20: <input type="number" id="r20" value="0" min="0"></label>
										<label>₹10: <input type="number" id="r10" value="0" min="0"></label>
										<label>₹5: <input type="number" id="r5" value="0" min="0"></label>
										<label>₹2: <input type="number" id="r2" value="0" min="0"></label>
										<label>₹1: <input type="number" id="r1" value="0" min="0"></label>
									</div>

									<!--<div class="amount-summary">
										<p><strong>Total Notes Amount:</strong> ₹<span id="totalDenomination">0</span>
										</p>
										<label>Offline Amount Received:
											<input type="number" id="amountReceived" min="1" readonly>
										</label>
										<label>Online Amount:
   										 <input type="number" id="onlineAmt" name="onlineAmt" readonly>
										</label>
										<p><strong>Change to Return:</strong> ₹<span id="changeReturn">0</span></p>
									</div>-->
									<div class="amount-summary">
										<p style="font-weight: bold; color: #2a8c2a;">
											<strong>Total Notes Amount:</strong> ₹<span id="totalDenomination">0</span>
										</p>

										<label style="font-weight: bold; color: #1d3557;">
											Offline Amount Received:
											<input type="number" id="amountReceived" min="1" readonly
												style="font-weight: bold;" />
										</label>
										<br />
										<label style="font-weight: bold; color: #e76f51;">
											<!--Online Amount Received:-->
											<input type="hidden" id="onlineAmt" name="onlineAmt" readonly
												style="font-weight: bold;" />
										</label>

										<p style="font-weight: bold; color: #e63946;">
											<strong>Change to Return:</strong> ₹<span id="changeReturn">0</span>
										</p>
									</div>



									<div class="denomination-grid">
										<label>₹2000: <input type="number" id="c2000" value="0" min="0"></label>
										<label>₹500: <input type="number" id="c500" value="0" min="0"></label>
										<label>₹200: <input type="number" id="c200" value="0" min="0"></label>
										<label>₹100: <input type="number" id="c100" value="0" min="0"></label>
										<label>₹50: <input type="number" id="c50" value="0" min="0"></label>
										<label>₹20: <input type="number" id="c20" value="0" min="0"></label>
										<label>₹10: <input type="number" id="c10" value="0" min="0"></label>
										<label>₹5: <input type="number" id="c5" value="0" min="0"></label>
										<label>₹2: <input type="number" id="c2" value="0" min="0"></label>
										<label>₹1: <input type="number" id="c1" value="0" min="0"></label>
									</div>

									<div class="modal-actions">
										<button type="button" id="confirmDenomination">✅ Confirm</button>
										<button type="button" class="cancel-button" id="cancelDenomination">❌
											Cancel</button>
									</div>

								</form>
							</div>
						</div>
						</tbody>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<!--<td><input type="text" id="totalRow" name="totalRow" disabled /></td>-->
									<td><button onclick="totalDen()" class="btn btn-success"
											>कुल डेनोमिनेशन</button></td>
					</table>
				</div>
			</div>
			</div>
		</div>
	</div>
	</div>
	<script th:replace="includes/script :: script"></script>
	<script th:if="${isDataMissing != null}" th:inline="javascript">
		alert("No data available!");
	</script>
	<script th:if="${isCollectionSaved != null}" th:inline="javascript">
		//alert(th:text = "${isCollectionSaved}");
		alert([[${#strings.escapeJavaScript(isCollectionSaved)}]]);
	</script>


	<script>
		document.addEventListener('DOMContentLoaded', function () {
			const radios = document.getElementsByName('paymentFilter');
			const tbody = document.querySelector('table tbody');
			const totalRow = document.getElementById('totalRow');
			const totalCell = document.getElementById('totalCollectionAmount');

			function updateTable(selectedValue) {
				const rows = tbody.querySelectorAll('tr');
				let total = 0;

				rows.forEach(row => {
					// Skip the total row from logic
					if (row.id === 'totalRow') return;

					const paymentCell = row.querySelector('td:nth-child(5)');
					const amountCell = row.querySelector('td:nth-child(6)');

					const method = paymentCell?.textContent.trim();
					const amount = parseFloat(amountCell?.textContent.trim()) || 0;

					const shouldShow = selectedValue === 'All' || method === selectedValue;
					row.style.display = shouldShow ? '' : 'none';

					if (shouldShow) {
						total += amount;
					}
				});

				// Update and re-append the total row to keep it at the end
				totalCell.textContent = total.toFixed(2);
				tbody.appendChild(totalRow); // move it to the end
			}

			// Attach event listeners
			radios.forEach(radio => {
				radio.addEventListener('change', () => {
					updateTable(radio.value);
				});
			});

			// Initial load
			updateTable('All');
		});
	</script>


	<script>
	///// TO MAKE THE TOTAL OF THE COLLECION AMOUNT FROM THE TABLE INPUT
const collectionamount = document.querySelectorAll('#collectionAmount');
//document.getElementById('total').style.display = "none"
var total;
function totalDen() {
	total = 0
	  let offlineTotal = 0;
    let onlineTotal = 0;
	collectionamount.forEach((input) => {
		if (input.value == "") {
			input.value = 0;
		}
		var no = parseInt(input.value);
		console.log("fhsdklfjsdlkfjflk;", no)
		total += no;
	});
	

	console.log("total =====total;", total)
	//document.getElementById('total').style.display = "block"
	//document.getElementById('total').textContent = total;
	//document.getElementById('total').value = total;
	/*document.getElementById('amountReceived').value = total;*/
	
	
	 document.querySelectorAll('tr').forEach(row => {
        const collectionInput = row.querySelector('input[name="collectionAmount"]');
       

        if (collectionInput) {
            const amount = parseFloat(collectionInput.value) || 0;
       

            
                offlineTotal += amount;
            
            
            
        }
        console.log("onlineTotal =====onlineTotal;", onlineTotal)
         document.getElementById("amountReceived").value = offlineTotal;
    document.getElementById("onlineAmt").value = onlineTotal;
    });
	
	 const modal = document.getElementById('denominationModal');
    if (modal) {
        modal.style.display = 'block';
    }
	
}
	</script>
	
	
	

	
	<script>
		
		document.addEventListener('DOMContentLoaded', function () {
	const modal = document.getElementById('denominationModal');
	const openButtons = document.querySelectorAll('.openDenominationModal');
	const cancelBtn = document.getElementById('cancelDenomination');
	const confirmBtn = document.getElementById('confirmDenomination');

	
	let currentForm = null;

	openButtons.forEach(button => {
		button.addEventListener('click', function () {
			currentForm = this.closest('form');
			  const customerId = this.getAttribute("data-customer-id");
console.log("customerId data----", customerId)
        // Set the hidden input value inside the modal
        document.getElementById("denominationCustomerId").value = customerId;
			modal.style.display = 'block';
		});
	});

	cancelBtn.addEventListener('click', function () {
		modal.style.display = 'none';
	});

	// Elements
	const noteInputs = [
		{ id: "r2000", value: 2000 },
		{ id: "r500", value: 500 },
		{ id: "r200", value: 200 },
		{ id: "r100", value: 100 },
		{ id: "r50", value: 50 },
		{ id: "r20", value: 20 },
		{ id: "r10", value: 10 },
		{ id: "r5", value: 5 },
		{ id: "r2", value: 2 },
		{ id: "r1", value: 1 }
	];

	const amountReceivedInput = document.getElementById("amountReceived");
	const totalDenominationEl = document.getElementById("totalDenomination");
	const changeReturnEl = document.getElementById("changeReturn");

	noteInputs.forEach(note => {
		const input = document.getElementById(note.id);
		input.addEventListener('input', calculateTotals);
	});

	amountReceivedInput.addEventListener('input', calculateTotals);

	function calculateTotals() {
		let total = 0;
		noteInputs.forEach(note => {
			const count = parseInt(document.getElementById(note.id).value) || 0;
			total += count * note.value;
		});
		totalDenominationEl.textContent = total;

		const received = parseInt(amountReceivedInput.value) || 0;
		const change = total - received;
		changeReturnEl.textContent = change > 0 ? change : 0;
	}
	
	
});

	</script>
	
	
<script>
	
	/*******************SAVE DENOMINATION CONFIRM***************/
document.addEventListener("DOMContentLoaded", function () {
document.getElementById("confirmDenomination").addEventListener("click", function () {
	
	const amountReceivedInput = document.getElementById("amountReceived");
		const amountReceived = parseInt(document.getElementById("amountReceived").value) || 0;


	if (!amountReceived || amountReceived <= 0) {
		alert("कृपया प्राप्त राशि दर्ज करें");
		amountReceivedInput.focus();
		return;
	}
	
	const totalAmount = parseInt(document.getElementById("totalDenomination").textContent) || 0;
	console.log("totalAmount data", totalAmount)
	if (!totalAmount || totalAmount <= 0) {
		alert("कृपया डेनोमिनेशन नोट दर्ज करें");
		return;
	}
	
	if (amountReceived > totalAmount) {
		alert("कृपया डेनोमिनेशन नोट और डेनोमिनेशन राशि चेक करें");
		return;
	}
	
	/*const notes = document.querySelectorAll(".note");
	const denominationData = [];

	notes.forEach(note => {
		const count = parseInt(note.value) || 0;
		const value = parseInt(note.getAttribute("data-value"));
		if (count > 0) {
			denominationData.push({ value, count });
		}
	});*/

	
	const changeReturn = parseInt(document.getElementById("changeReturn").textContent) || 0;
	const onlineAmt = parseInt(document.getElementById("onlineAmt").value) || 0;
	
	console.log("totalAmount data", onlineAmt)
	
const r2000 = parseInt(document.getElementById("r2000").value) || 0;
const r500 = parseInt(document.getElementById("r500").value) || 0;
const r200 = parseInt(document.getElementById("r200").value) || 0;
const r100 = parseInt(document.getElementById("r100").value) || 0;
const r50 = parseInt(document.getElementById("r50").value) || 0;
const r20 = parseInt(document.getElementById("r20").value) || 0;
const r10 = parseInt(document.getElementById("r10").value) || 0;
const r5 = parseInt(document.getElementById("r5").value) || 0;
const r2 = parseInt(document.getElementById("r2").value) || 0;
const r1 = parseInt(document.getElementById("r1").value) || 0;


const c2000 = parseInt(document.getElementById("c2000").value) || 0;
const c500 = parseInt(document.getElementById("c500").value) || 0;
const c200 = parseInt(document.getElementById("c200").value) || 0;
const c100 = parseInt(document.getElementById("c100").value) || 0;
const c50 = parseInt(document.getElementById("c50").value) || 0;
const c20 = parseInt(document.getElementById("c20").value) || 0;
const c10 = parseInt(document.getElementById("c10").value) || 0;
const c5 = parseInt(document.getElementById("c5").value) || 0;
const c2 = parseInt(document.getElementById("c2").value) || 0;
const c1 = parseInt(document.getElementById("c1").value) || 0;

const customerId = 0;//document.getElementById("denominationCustomerId").value;
	const receiptNo =  0;//document.getElementById("receiptNo").value;

const asondate = document.getElementById("asondate").value;
console.log("asondate data", asondate)
const data = {
		amountReceived,
		totalAmount,
		changeReturn,
		customerId,
		receiptNo,
		r2000,
		r500,
		r200,
		r100,
		r50,
		r20,
		r10,
		r5,
		r2,
		r1, 
		c2000,
		c500,
		c200,
		c100,
		c50,
		c20,
		c10,
		c5,
		c2,
		c1,
		asondate,
		onlineAmt
	};


	/*const data = {
		denominations: denominationData,
		amountReceived,
		totalAmount,
		changeReturn,
		customerId,
		receiptNo
	};*/
	
console.log("denomination data", data)
	fetch('/myapp/saveMultipleDenomination', {
		method: 'POST',
		headers: {
			'Content-Type': 'application/json'
		},
		body: JSON.stringify(data)
	})
	.then(response => response.json())
	.then(result => {
		alert(result.message || 'Denomination saved successfully!');
		 document.getElementById('denominationForm').reset(); // Clears form
    document.getElementById('totalDenomination').innerText = "0";
    document.getElementById('changeReturn').innerText = "0";
		document.getElementById("denominationModal").style.display = "none";
	})
	.catch(error => {
		console.error('Error:', error);
		alert('Failed to save denomination.');
	});
});
});
	
</script>	

	
	<script>

		// Cancel button in modal
document.addEventListener("DOMContentLoaded", function () {
	document.getElementById('cancelDenomination').addEventListener('click', function () {
		
		 const total = parseInt(document.getElementById('totalDenomination').innerText);

    if (total === 0) {
        alert("कृपया डिनोमिनेशन दर्ज करें।"); // "Please enter denomination."
        
        const modal = document.getElementById('denominationModal');
      if (modal) {
        modal.style.display = 'block';
      }
        
        return; // Stop closing the modal
    }
		
		
		document.getElementById('denominationForm').reset(); // Clears form
    document.getElementById('totalDenomination').innerText = "0";
    document.getElementById('changeReturn').innerText = "0";
		document.getElementById('denominationModal').style.display = 'none';
		window.collectionFormToSubmit = null;
	});
});
/**/
		
	</script>
	
	<!--<footer th:replace="includes/footer :: footer"></footer>-->
</body>

</html>