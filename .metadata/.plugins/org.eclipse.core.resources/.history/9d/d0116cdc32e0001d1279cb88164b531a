package com.idsspl.webproject.serviceImpl;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

import com.idsspl.webproject.entity.AgentCollectionEntity;
import com.idsspl.webproject.entity.AgentEntity;
import com.idsspl.webproject.model.AgentCollectionModel;
import com.idsspl.webproject.model.AgentModel;
import com.idsspl.webproject.repo.AgentCollectionRepo;
import com.idsspl.webproject.repo.AgentRepo;
import com.idsspl.webproject.service.AgentService;

@Service
public class AgentServiceImpl implements AgentService {
	@Autowired
	private AgentRepo agentRepo;
	
	@Autowired
	private AgentCollectionRepo agentCollectionRepo;

	@Autowired
	private RestTemplate restTemplate;

	@Override
	public String sayHello() {
		String response = restTemplate.getForObject("http://localhost:3000/king", String.class);
		return response;
//		RestTemplate restTemplate = new RestTemplate();
//		String apiUrl = "http://localhost:8080/getUserName";
//		String username = "admin";
//		String password = "pnath@123";
//		HttpHeaders headers = new HttpHeaders();
//		headers.setBasicAuth(username, password);
//		HttpEntity<String> request = new HttpEntity<>(headers);
//		String response = restTemplate.exchange(apiUrl, HttpMethod.GET, request, String.class).getBody();
//		return response;
	}

	@Override
	public List<AgentModel> getAgentsList(AgentModel agent) {

		List<AgentEntity> agentEntityList = agentRepo.findByCustomerId(agent.getCustomerId());
		List<AgentModel> agentModelList = new ArrayList<>();

		agentEntityList.stream().forEach(agentEntity -> {
			AgentModel agentModel = new AgentModel();
			agentModel.setAccountCode(agentEntity.getAccountCode());
			agentModel.setCustomerId(agentEntity.getCustomerId());
			agentModel.setLedgerbalance(agentEntity.getLedgerbalance());
			agentModel.setName(agentEntity.getName());
			agentModel.setAccountType(agentEntity.getAccountType());
			agentModelList.add(agentModel);

		});

		return agentModelList;
	}

	@Override
	public String saveAgentCollection(ArrayList<AgentCollectionModel> agentCollection) {
		for (AgentCollectionModel agent : agentCollection) {
			AgentCollectionEntity newAgent = null;
			newAgent.setAccountCode(agent.getAccountCode());
			newAgent.setAccountType(agent.getAccountType());
			newAgent.setCollectionAmount(agent.getCollectionAmount());
			newAgent.setCustomerId(agent.getCustomerId());
			newAgent.setLedgerbalance(agent.getLedgerbalance());
			newAgent.setName(agent.getName());
			System.out.println("customerId-----" + newAgent.getCustomerId());
			System.out.println("accountCode-----" + newAgent.getAccountCode());
			System.out.println("accountType-----" + newAgent.getAccountType());
			System.out.println("name-----" + newAgent.getName());
			System.out.println("ledgerbalance-----" + newAgent.getLedgerbalance());
			System.out.println("CollectionAmount-----" + newAgent.getCollectionAmount());
			
			agentCollectionRepo.save(newAgent);

		}
		return null;
	}

//	@Override
//	public List<AgentCollectionModel> saveAgentCollection(AgentCollectionModel agentCollection) {
//
//		List<AgentCollectionModel> agentModelList = new ArrayList<>();
//
//		agentEntityList.stream().forEach(agentEntity -> {
//			AgentModel agentModel = new AgentModel();
//			agentModel.setAccountCode(agentEntity.getAccountCode());
//			agentModel.setCustomerId(agentEntity.getCustomerId());
//			agentModel.setLedgerbalance(agentEntity.getLedgerbalance());
//			agentModel.setName(agentEntity.getName());
//			agentModel.setAccountType(agentEntity.getAccountType());
//			agentModelList.add(agentModel);
//
//		});
//
//		return agentModelList;
//	}
}
