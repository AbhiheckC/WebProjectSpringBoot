package com.idsspl.webproject.serviceImpl;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

import com.idsspl.webproject.entity.AgentCollectionEntity;
import com.idsspl.webproject.entity.AgentEntity;
import com.idsspl.webproject.model.AgentCollectionModel;
import com.idsspl.webproject.model.AgentModel;
import com.idsspl.webproject.repo.AgentCollectionRepo;
import com.idsspl.webproject.repo.AgentRepo;
import com.idsspl.webproject.service.AgentService;

@Service
public class AgentServiceImpl implements AgentService {
	@Autowired
	private AgentRepo agentRepo;

	@Autowired
	private AgentCollectionRepo agentCollectionRepo;

	@Autowired
	private RestTemplate restTemplate;

	@Override
	public String sayHello() {
		String response = restTemplate.getForObject("http://localhost:3000/king", String.class);
		return response;
//		RestTemplate restTemplate = new RestTemplate();
//		String apiUrl = "http://localhost:8080/getUserName";
//		String username = "admin";
//		String password = "pnath@123";
//		HttpHeaders headers = new HttpHeaders();
//		headers.setBasicAuth(username, password);
//		HttpEntity<String> request = new HttpEntity<>(headers);
//		String response = restTemplate.exchange(apiUrl, HttpMethod.GET, request, String.class).getBody();
//		return response;
	}

	@Override
	public List<AgentModel> getAgentsList(AgentModel agent) {

		List<AgentEntity> agentEntityList = agentRepo.findByCustomerId(agent.getCustomerId());
		List<AgentModel> agentModelList = new ArrayList<>();

		agentEntityList.stream().forEach(agentEntity -> {
			AgentModel agentModel = new AgentModel();
			agentModel.setAccountCode(agentEntity.getAccountCode());
			agentModel.setCustomerId(agentEntity.getCustomerId());
			agentModel.setLedgerbalance(agentEntity.getLedgerbalance());
			agentModel.setName(agentEntity.getName());
			agentModel.setAccountType(agentEntity.getAccountType());
			agentModelList.add(agentModel);

		});

		return agentModelList;
	}

	@Override
	public String saveAgentCollection(AgentCollectionModel agentCollection) {
		AgentCollectionEntity newAgent = new AgentCollectionEntity();
		newAgent.setAccountCode(agentCollection.getAccountCode());
		newAgent.setAccountType(agentCollection.getAccountType());
		newAgent.setCollectionAmount(agentCollection.getCollectionAmount());
		newAgent.setCustomerId(agentCollection.getCustomerId());
		newAgent.setLedgerbalance(agentCollection.getLedgerbalance());
		newAgent.setName(agentCollection.getName());
		System.out.println("customerId-----" + agentCollection.getCustomerId());
		System.out.println("accountCode-----" + agentCollection.getAccountCode());
		System.out.println("accountType-----" + agentCollection.getAccountType());
		System.out.println("name-----" + agentCollection.getName());
		System.out.println("ledgerbalance-----" + agentCollection.getLedgerbalance());
		System.out.println("CollectionAmount-----" + agentCollection.getCollectionAmount());
		System.out.println("latitute-----" + agentCollection.getLatitude());
		System.out.println("latitute-----" + agentCollection.getLongitude());

		try {
			agentCollectionRepo.save(newAgent);
			return "Saved Successfully";
		} catch (Exception e) {
			return "Error saving  data: " + e.getMessage();
		}
	}

//	@Override
//	public List<AgentCollectionModel> saveAgentCollection(AgentCollectionModel agentCollection) {
//
//		List<AgentCollectionModel> agentModelList = new ArrayList<>();
//
//		agentEntityList.stream().forEach(agentEntity -> {
//			AgentModel agentModel = new AgentModel();
//			agentModel.setAccountCode(agentEntity.getAccountCode());
//			agentModel.setCustomerId(agentEntity.getCustomerId());
//			agentModel.setLedgerbalance(agentEntity.getLedgerbalance());
//			agentModel.setName(agentEntity.getName());
//			agentModel.setAccountType(agentEntity.getAccountType());
//			agentModelList.add(agentModel);
//
//		});
//
//		return agentModelList;
//	}
}
