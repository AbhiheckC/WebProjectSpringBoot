<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
	<title>मेंबर लोकेशन पेज</title>
	<style th:replace="includes/style :: style"></style>
	<link href="style/agentLocationStyle.css" rel="stylesheet" />
</head>

<body class="backgroundColor">
	<header th:replace="includes/header :: header"></header>
	<div class="container">
		<div class="row text-center">
			<div class="col-sm-12 col-md-12">
				<a href="/myapp/home" class="btn btn-info text-white float-end">पीछे जाइये</a>
			</div>
			<div class="col-sm-12 col-md-12">
				<form th:action="@{/getAgentLocation}" method="post" class="singleInputButtonForm form">
					<h3 class="text-center heading">एजेंट लोकेशन फॉर्म</h3>
					<input type="text" id="agentId" name="agentId" placeholder="एजेंट आईडी"
						class=".ui-box .top-leftStart-backward" required />
					<input type="submit" onclick="openMap()" class="submitBtn" value="Submit" />
				</form>
			</div>
		</div>
		
		<div ><!--th:if="${agentLocations != null}" -->
			<div class="row agentLocationDiv" th:each="location : ${agentLocations}">
				<div class="col mt-4">
					<div class="mb-4">
						<div class="text-center" id="agentMapBtnDiv">
							<!--<img th:src="@{'data:image/jpeg;base64,' + ${customer.signature}}" alt="avatar"
								class="img-fluid" style="width:250px; height:150px">-->
							<div class="row">
								<div class="col-12">
									<h6><b>एजेंट आईडी : </b><span th:text="${location.agentId}"></span></h6>
								</div>
								<div class="col-12">
									<h6><b>एजेंट नाम : </b><span th:text="${location.agentName}"></span></h6>
								</div>
							</div>
							
							<input type="text" id="latitude" name="latitude" th:value="${location.latitude}" />
							<input type="text" id="longitude" name="longitude" th:value="${location.longitude}" />
							<button onclick="openMap()" id="mapBtn" class="blackBtn">Show Map</button>
						</div>
					</div>
				</div>
			</div>
			<div id="mapDiv">
				<div id="mapholder">
				</div>
				<button onclick="closeMap()" id="closeMapBtn" class="blackBtn">Close</button>
			</div>
		</div>
		<script th:replace="includes/script :: script"></script>
		<script th:if="${isDataMissing != null}">
			alert("No data available!");
		</script>
		<script>
			function openMap() {
				var mapDiv = document.getElementById('mapholder');

				var displaySetting = mapDiv.style.display;

				var closeMapBtn = document.getElementById('closeMapBtn');

				if (displaySetting == 'block') {
					mapDiv.style.display = 'none';
					closeMapBtn.style.display = 'none';
				}
				else {
					mapDiv.style.display = 'block';
					closeMapBtn.style.display = 'block';
					//mapButton.innerHTML = 'Close Map';
					getLocation();
				}
			}
			function closeMap() {
				var mapDiv = document.getElementById('mapholder');
				var displaySetting = mapDiv.style.display;
				var closeMapBtn = document.getElementById('closeMapBtn');
				if (displaySetting == 'block') {
					mapDiv.style.display = 'none';
					closeMapBtn.style.display = 'none';
				}
			}
			function getLocation() {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(showPosition, showError);
				}
			}
			function showPosition(position) {
				var lat = document.getElementById("latitude").value;
				var lon = document.getElementById("longitude").value;
				console.log("lat--",lat)
				console.log("lon--",lon)
				var latlon = new google.maps.LatLng(lat, lon);
				var mapholder = document.getElementById('mapholder');

				var myOptions = {
					center: latlon, zoom: 14,
					mapTypeId: google.maps.MapTypeId.ROADMAP,
					mapTypeControl: false,
					navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL}
				}

				var map = new google.maps.Map(document.getElementById("mapholder"), myOptions);
				var marker = new google.maps.Marker({position: latlon, map: map, title: "You are here!"});
			}

			function showError(error) {
				switch (error.code) {
					case error.PERMISSION_DENIED:
						x.innerHTML = "User denied the request for Geolocation."
						break;
					case error.POSITION_UNAVAILABLE:
						x.innerHTML = "Location information is unavailable."
						break;
					case error.TIMEOUT:
						x.innerHTML = "The request to get user location timed out."
						break;
					case error.UNKNOWN_ERROR:
						x.innerHTML = "An unknown error occurred."
						break;
				}
			}
		</script>
		<script
			src="https://maps.google.com/maps/api/js?key=AIzaSyALw7Ir5EeLpFWv0YYEfS6mrnNwGJxyvWA&callback=getLocation"
			defer="true" async="true"></script>
</body>

</html>