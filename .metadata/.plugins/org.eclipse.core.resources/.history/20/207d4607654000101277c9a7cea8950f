package com.idsspl.webproject.serviceImpl;

import java.time.LocalDateTime;
import java.util.Random;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.idsspl.webproject.entity.Denomination;
import com.idsspl.webproject.entity.UserEntity;
import com.idsspl.webproject.model.DenominationRequest;
import com.idsspl.webproject.repo.DenominationRepository;
import com.idsspl.webproject.repo.UserRepo;

@Service

public class DenominationServiceImpl {

	@Autowired
	private DenominationRepository denominationRepository;

	@Autowired
	private UserRepo userRepo;
	
	public void save(DenominationRequest request, String userName) {
		for (DenominationRequest.NoteEntry note : request.getDenominations()) {
			Denomination entity = new Denomination();
			
		///// TO GENERATE THE RANDOM UNIQUE ID
			String CHARACTERS = "0123456789";
			Random random = new Random();
			StringBuilder sb = new StringBuilder(10);
			for (int i = 0; i < 10; i++) {
				int index = random.nextInt(CHARACTERS.length());
				char randomChar = CHARACTERS.charAt(index);
				sb.append(randomChar);
			}
			String id = sb.toString();
			
			UserEntity userEntity = null;
			userEntity = userRepo.findByUserName(userName);
			entity.setAgentId(userEntity.getAgentId());
			
			entity.setId(Long.parseLong(id));
			System.out.println("===note.getValue()==="+note.getValue());
			entity.setNoteValue(note.getValue());
			entity.setNoteCount(note.getCount());
			entity.setAmountReceived(request.getAmountReceived());
			entity.setTotalAmount(request.getTotalAmount());
			entity.setChangeReturn(request.getChangeReturn());
			entity.setCustomerId(request.getCustomerId());
			entity.setAgentName(userName);
			entity.setReceiptNo(request.getReceiptNo());
			entity.setCreatedAt(LocalDateTime.now());
			System.out.println("denomination entty===="+entity);
			denominationRepository.save(entity);
		}
	}
	
}
